# this group holds any packages needed to build other packages besides GCC.

[group buildtools]
packages = cmake, gmp, ppl, mpfr, mpc, isl, cloog, gcc
#, ups
build_target = bin/{package}
install_target = bin/{package}
# Put everything into gcc's install_dir
install_dir = {PREFIX}/gcc/{gcc_version}/{tagsdashed}

# biuldenv_COMPILER_PATH = set:{install_dir}/bin
# buildenv_LD_LIBRARY_PATH = prepend:{install_dir}/lib

# buildenv_LIBRARY_PATH = set:/usr/lib/{gcc_multiarch}
# buildenv_C_INCLUDE_PATH = set:/usr/include/{gcc_multiarch}
# buildenv_CPLUS_INCLUDE_PATH = set:/usr/include/{gcc_multiarch}
# buildenv_CPATH = set:/usr/include/{gcc_multiarch}


[package gmp]
version = 5.0.5
source_url = ftp://ftp.gmplib.org/pub/{source_unpacked}/{source_archive_file}
source_archive_ext = tar.bz2
prepare_cmd_options = --prefix={install_dir} --enable-cxx
build_target = libgmp.la
install_target = lib/libgmp.la
buildenv_CPPFLAGS = -fexceptions

[package ppl]
version = 0.12.1
source_url = http://bugseng.com/products/ppl/download/ftp/releases/{version}/{source_archive_file}
source_archive_ext = tar.bz2
prepare_cmd_options = --prefix={install_dir} --without-java --with-gmp={gmp_install_dir}
depends = prepare:gmp_install
build_target = interfaces/C/libppl_c.la
install_target = lib/libppl_c.la
buildenv_CXXFLAGS = set:-fno-access-control
buildenv_CPPFLAGS = -I{install_dir}/include
buildenv_LDFLAGS = -L{install_dir}/lib

[package mpfr]
version = 3.1.2
source_url = http://www.mpfr.org/mpfr-current/{source_archive_file}
source_archive_ext = tar.bz2
prepare_cmd_options = --prefix={install_dir} --with-gmp={gmp_install_dir}
depends = prepare:gmp_install
build_target = src/libmpfr.la
install_target = lib/libmpfr.la

[package mpc]
version = 0.9
source_url = http://www.multiprecision.org/mpc/download/{source_archive_file}
prepare_cmd_options = --prefix={install_dir} --with-gmp={gmp_install_dir} --with-mpfr={mpfr_install_dir}
depends = prepare:gmp_install, prepare:mpfr_install
build_target = src/libmpc.la
install_target = lib/libmpc.la

[package isl]
version = 0.11.1
source_url = ftp://gcc.gnu.org/pub/gcc/infrastructure/{source_archive_file}
source_archive_ext = tar.bz2
prepare_cmd_options = --prefix={install_dir} --with-gmp-prefix={gmp_install_dir}
depends = prepare:gmp_install
build_target = libisl.la
install_target = lib/libisl.la

[package cloog]
version = 0.18.0
source_url = ftp://gcc.gnu.org/pub/gcc/infrastructure/{source_archive_file}
prepare_cmd_options = --prefix={install_dir} --with-gmp-prefix={gmp_install_dir} --with-ppl={ppl_install_dir} 
depends = prepare:gmp_install, prepare:ppl_install, prepare:isl_install
build_target = cloog
install_target = bin/cloog

[package gcc]
version = {gcc_version}
source_url = http://www.netgull.com/gcc/releases/{source_unpacked}/{source_archive_file}
source_archive_ext = tar.bz2
prepare_cmd_options = --prefix={install_dir} --with-gmp={gmp_install_dir} --with-mpc={mpc_install_dir} --with-mpfr={mpfr_install_dir} --with-ppl={ppl_install_dir} --with-cloog={cloog_install_dir} --enable-cloog-backend=isl --with-gnu-as --with-gnu-ld --disable-libgcj --enable-threads=posix --enable-languages=c,c++,objc,fortran
depends = prepare:gmp_install, prepare:mpc_install, prepare:mpfr_install, prepare:ppl_install, prepare:isl_install, prepare:cloog_install
build_cmd = env && make
build_cmd_options = -j{NCPUS} bootstrap
build_target = gcc/xgcc
buildenv_CXXFLAGS = set:-fPIC
buildenv_CFLAGS = set:-fPIC
buildenv_LD_LIBRARY_PATH = prepend:{install_dir}/lib
export_PATH = prepend:{install_dir}/bin
# allow both lib/libgmp.so and lib64/libstc++.so to be picked up
export_LD_LIBRARY_PATH = prepend:{install_dir}/lib:{install_dir}/lib64

[package cmake]
version = 2.8.8
environment = package:gcc
depends = prepare:gcc_install
features = tarball prepare makemake
source_url = http://www.cmake.org/files/v{version_2digit}/{source_archive_file}
unpacked_target = bootstrap
prepare_cmd = ../../{source_dir}/{source_unpacked}/bootstrap
prepare_cmd_options = --prefix={install_dir}
prepare_target = cmake_install.cmake
export_PATH = prepend:{install_dir}/bin


# used at FNAL for user environment management but also insanely
# required for building art.
[package ups]
version = 5.0.0
features = tarball, prepare, makemake
source_archive_file = ups-upd-{version}-source.tar.bz2
source_url = http://oink.fnal.gov/distro/relocatable-ups/{source_archive_file}
source_unpacked = ups
unpacked_target = v{version_underscore}/source/ups500.tar.gz
prepare_cmd = tar -xzf ../../{source_dir}/{source_unpacked}/{unpacked_target}
prepare_target = Makefile
buildenv_UPS_DIR = set:{out}/{build_dir}
buildenv_PRODUCTS = set:{upsprod_dir}
#build_cmd = cd src && ../bin/upspremake
build_cmd = make all
build_cmd_options = && /bin/true
build_target = bin/ups
install_cmd = cp 
install_cmd_options = -a * {install_dir}/
install_target = bin/ups
export_PATH = prepend:{install_dir}/bin
export_PRODUCTS = set:{upsprod_dir}
export_UPS_DIR = set:{install_dir}
